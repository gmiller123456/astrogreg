<html>
<head>
<title></title>
<style>
body{}
</style>
</head>    
<body>
<script src="astro.js"></script>
<canvas id="canvas" width=2008 height=567 style="border:solid"></canvas>

<script>
const tr=Math.PI/180;

const c = document.getElementById("canvas");
const w=document.getElementById("canvas").width;
const h=document.getElementById("canvas").height;
const ctx = c.getContext("2d");

ctx.strokeStyle="white";

clearCanvas();
setBackground();

//8:59pm May 14, 2021
//Moon az 280 43' 03.6" alt +27 54' 12.7"
//Ven  az 291 05' 36.0" alt  +8 33' 27.6"
//Mer  az 288 45' 07.9" alt +17 18' 28.1"
//Sunset 8:46

function clearCanvas(){
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);    
}

function drawOther(){
    ctx.strokeStyle="red";
    plotPoint([(291+5.0/60.0+ 36.0/3600.0)*tr,(8+ 33/60.0 +27.6/3600.0)*tr])
    plotPoint([(280 + 43/60.0 + 3.6/3600.0)*tr,(+27+ 54/60.0 + 12.7/3600.0)*tr])

}

function setBackground(){
    const i=new Image();
    i.src="20210514_205902-r.jpg";

    i.onload = () => {
        ctx.drawImage(i,1008,0);
        run();
        //drawOther();
    }
}

function mapAltAzToScreen(p){
    const scale=8.9;
    const a=new Array();
    a[0]=p[0]/(2*Math.PI)*w*scale*.29-2590;
    a[1]=h-p[1]/(2*Math.PI)*h*scale-145;

    return a;
}

function plotPoint(p){

    p=mapAltAzToScreen(p);

    ctx.beginPath();
    ctx.arc(p[0],p[1], 1, 0, 2 * Math.PI);
    ctx.stroke();
}

function getVenusAltAzAtSunset(jd){
    let earth=getPlanet(jd,2);
    let sun=new Array();
    sun[0]=0;
    sun[1]=0;
    sun[2]=0;

    sun=astro.sub(sun,earth);
    const sunradec=astro.xyzToRaDec(sun);

    const lon=274.236400*tr;
    const lat=38.2464000*tr;
    //const lat=-30*tr;

    let sunrst=astro.getRiseSet(jd,lat,-lon,sunradec[0],sunradec[1]); //Negate longitude for Meeus algorithms.
    const sunset=(sunrst[2]-12+24.25)/24+jd;

    earth=getPlanet(sunset,2);
    let venus=getPlanet(sunset,1);
    venus=astro.sub(venus,earth);

    const venusrd=astro.xyzToRaDec(venus);
    const venusaa=astro.raDecToAltAz(venusrd[0],venusrd[1],lat,lon,sunset);
    return venusaa;

}

function run(){
    const jd=astro.gregorianDateToJulianDate(2021,04,1,12,0,0);

    for(let i=0;i<300;i++){
        if(jd+i==2459348){
            ctx.strokeStyle="blue";
        } else {
            ctx.strokeStyle="white";
        }
        let aa=getVenusAltAzAtSunset(jd+i);
        plotPoint(aa);
    }

}

function getPlanet(jd,planet){
    let extraterms=[];
    if(planet>3){
        //extraterms=astro.extraTerms[planet-4];
    }
    return astro.computePlanetPosition(jd,astro.data1800to2050[planet][0],astro.data1800to2050[planet][1],extraterms);
}

function formatTime(h){

    const tz=(new Date().getTimezoneOffset())/60.0;

    let t=h-tz;
    if(t>=24){t-=24;}
    if(t<0){t+=24;}


    let hours=Math.floor(t);
    t-=hours;
    t*=60;
    let min=Math.floor(t);
    t-=min;
    t*=60;
    let sec=Math.floor(t);

    if(hours<10){hours="0"+hours;}
    if(min<10){min="0"+min;}
    if(sec<10){sec="0"+sec;}

    return hours+":"+min+":"+sec;

}



</script>
</body>
</html>